<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Media Player</title>
    
    <meta name="theme-color" content="#A10000">

    <meta charset="utf-8" />
    <meta name="viewport" content="viewport-fit=cover, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, shrink-to-fit=no, interactive-widget=overlays-content" >
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src *; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'; img-src * data: 'unsafe-inline'; connect-src * 'unsafe-inline'; frame-src *;"> -->
    
    <!-- OpenGraph/Social sharing -->
    <meta
      name="description"
      content="An installable media player app."
    />
    <meta
      name="og:description"
      content="An installable media player app."
    />
    <meta
      property="og:image"
      content="https://cdn.glitch.global/4604ff4b-6eb8-48c8-899f-321d23359af1/Media%20Player%20OG%20Image.png?v=1721623654736"
    />
    <meta property="og:title" content="Media Player" />
    <meta name="twitter:card" content="summary" />
    <!-- 
    <link
      rel="icon"
      href="https://cdn.glitch.global/4604ff4b-6eb8-48c8-899f-321d23359af1/play.svg?v=1720968680771"
    /> -->
    <link
      rel="icon"
      href="https://ivansojivarghese.github.io/media-player/play.png"
    />
    
    <link rel="stylesheet" type="text/css" href="https://ivansojivarghese.github.io/media-player/main.css" />
    <link rel="stylesheet" type="text/css" href="https://ivansojivarghese.github.io/media-player/new.css" />
    <link rel="stylesheet" type="text/css" href="https://ivansojivarghese.github.io/media-player/res_m.css" />
    
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
    </style>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Raleway&display=swap');
    </style>
    
    <!-- <script src="https://cdn.jsdelivr.net/npm/@thelevicole/youtube-to-html5-loader@5/dist/YouTubeToHtml5.js"></script> -->
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- PWA setup - update public/sw.js if you add your own assets like a new .css file -->
    <link rel="manifest" href="https://ivansojivarghese.github.io/media-player/manifest.json" />
    
    <script src="https://ivansojivarghese.github.io/media-player/index.js" async defer></script>
    
  </head>
  <body>
    <main>
      <div class="content">
        <!-- <h1 style="display: none;">Media Player <span>for YouTube</span></h1> -->

        <div id="videoContainer" class="trs">
          <video class="trs">
            <audio></audio>
          </video> 
          <div id="videoControls" class="trs">
              <div id="playPauseButton">
                <div class="img"></div>
              </div>
              <div id="fullscreenButton">
                <div class="img controlButton"></div>
              </div>
              <div id="pipButton">
                <div class="img controlButton"></div>
              </div>
              <div id="seekForwardButton" class="no-tap">
                <div class="img controlButton no-tap"></div>
              </div>
              <div id="seekBackwardButton" class="no-tap">
                <div class="img controlButton no-tap"></div>
              </div>
              <p class="seekText forward trs">+10 sec.</p>
              <p class="seekText backward trs">-10 sec.</p>
              <p id="videoCurrentTime"></p>
              <div id="videoProgressBar"></div>
              <div id="videoLoadProgressBar"></div>
          </div>
        </div>

        <div class="card trs settings" onclick="openWrap('settings')">
          <div class="img"></div>
        </div>
        <!-- 
        <div class="card upload" onclick="document.getElementById('fileSelector').click()">
              <input class="card upload" id="fileSelector" type="file" style="display: none;" multiple accept=".mp4, .webm, .ogg"/>
            <input class="card img upload" type="button">
            </div> -->
      </div>
      <div id="settingsOptions" class="wrap" onclick="closeWrap(event, 'settings')">
        <div class="container">
            <!-- 
            <div class="card fullscreen" onclick="toggleFulls()">
              <div class="img"></div>
            </div>
            <div class="card play" onclick="play()">
              <div class="img"></div>
            </div>
            <div class="card pause" onclick="pause()">
              <div class="img"></div>
            </div> 
            <div class="card load" onclick="load()">
              <div class="img"></div>
            </div> -->
            <div class="card install" onclick="" style="opacity: 0.3;">
              <div class="img"></div>
            </div>
            
            <div class="card upload" onclick="document.getElementById('fileSelector').click()">
              <input class="card upload" id="fileSelector" type="file" style="display: none;" multiple accept=".mp4, .webm, .ogg"/>
            <input class="card img upload" type="button">
            </div> 
          
            <div class="card web_upload" onclick="openWrap('webupload')">
              <div class="img"></div>
            </div>
          <!-- 
            <div class="card pip" onclick="togglePiP()" style="display: none;">
              <div class="img"></div>
            </div> -->
          <!-- 
            <div class="card pip">
              <div class="img"></div>
            </div>
            <div class="card pip">
              <div class="img"></div>
            </div>
            <div class="card pip">
              <div class="img"></div>
            </div>
            <div class="card pip">
              <div class="img"></div>
            </div> -->
          </div>
        </div>
      <div id="urlInput" class="wrap" onclick="closeWrap(event, 'webupload')">
        <div class="container block">
            <h3>URL Entry</h3>
            <p>for YouTube</p>
            <input class="noExit" type="url" id="urlBar" placeholder="Media URL" name="">
            <input id="urlSubmit" class="" type="submit" onclick="getURL()">
        </div>
      </div>
    </main>
  </body>
  <script src="https://ivansojivarghese.github.io/media-player/dev.js"></script>
  <script src="https://ivansojivarghese.github.io/media-player/msc.js"></script>
  <script src="https://ivansojivarghese.github.io/media-player/script.js"></script>
  <script src="https://ivansojivarghese.github.io/media-player/request.js"></script>
  <script src="https://ivansojivarghese.github.io/media-player/video.js"></script>
  <script>
    
    var wrap = document.querySelector("#settingsOptions");
        if (window.FileList && window.File) {
          document.getElementById('fileSelector').addEventListener('change', event => {
              // console.log(event.target.files[0]);
              
              const file = event.target.files[0];
              
              var fileURL = URL.createObjectURL(file)
              video.src = fileURL;
            
              video.play();
            
              // video.classList.remove("error");
            
              // video.style.border = "0.15rem solid #A10000";
            
              wrap.style.display = "";
          });
        }

  </script>
  <script>
    function isDarkMode() { // dark mode detection
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    }
    
    if (isDarkMode()) {
      document.body.style.color = "#FFF";
      document.body.style.backgroundColor = "#171717";
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',({ matches }) => { // detect color theme (live) change
      if (matches) { // change to dark mode
        document.body.style.color = "#FFF";
        document.body.style.backgroundColor = "#171717";
      } else {
        document.body.style.color = "";
        document.body.style.backgroundColor = "";
      }
    });
  </script>
  <script>
    var wrap = document.querySelector("#settingsOptions");
    function togglePiP() {
      const video = document.querySelector('video');
       if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        } else if (document.pictureInPictureEnabled) {
          video.requestPictureInPicture();
        }
      wrap.style.display = "";
    }
    function toggleFulls() {
      const video = document.querySelector('video');
      video.requestFullscreen();
      wrap.style.display = "";
    }/*
    function play() {
      const video = document.querySelector('video');
      video.play();
      wrap.style.display = "";
    }
    function pause() {
      const video = document.querySelector('video');
      video.pause();
      wrap.style.display = "";
    }*/
    function load() {
      const video = document.querySelector('video');
      video.load();
      // wrap.style.display = "";
    }
    function mute() {
      const video = document.querySelector('video');
      if (!video.muted) {
        video.muted = true;
      } else {
        video.muted = false;
      }
      wrap.style.display = "";
    }
  </script>
  <script>
      function openWrap(mod) {
        if (mod === 'settings') {
          var wrap = document.querySelector("#settingsOptions");
        } else {
          var wrap = document.querySelector("#urlInput");
          var wrapURL = document.querySelector("#urlBar");
          setTimeout(function() {
            wrapURL.focus();
          }, 100);
        }
        wrap.style.display = "block";
      }

      function closeWrap(e, mod) {
        if (mod === 'settings') {
          var wrap = document.querySelector("#settingsOptions");
          if (e !== null) {
            if (!e.target.classList.contains("card") && !e.target.classList.contains("img")) {
              wrap.style.display = "";
            }
          } else {
            wrap.style.display = "";
          }
        } else {
          var wrap = document.querySelector("#urlInput");
          var urlBar = document.querySelector("#urlBar");
          if (!e.target.classList.contains("noExit")) {
            wrap.style.display = "";
            urlBar.value = "";
          }
        }
        
      }
  </script>
  <script>
    var settingsBtn = document.querySelector(".card.settings");
    var videoPlaying = false;

    video.onplay = (event) => {
      videoPlaying = true;
      // video.style.border = "0.15rem solid #007000";
    };
    
    document.onclick = function() {
      if (!video.classList.contains("error") && video.src && videoPlaying) {
        // video.style.border = "0.15rem solid #007000";
      }
    };
    /*
    document.addEventListener("visibilitychange", function() {
      if (document.visibilityState === 'hidden') {
         if (!video.classList.contains("error") && video.src) {
            // video.style.border = "0.15rem solid #A10000";
          }
      }
    });*/
  </script>
  <script>

    // REFERENCE: https://web.dev/articles/customize-install

    // Initialize deferredPrompt for use later to show browser install prompt.
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Stash the event so it can be triggered later.
      deferredPrompt = e;
      // Update UI notify the user they can install the PWA
      showInstallPromotion();
      // Optionally, send analytics event that PWA install promo was shown.
      // console.log(`'beforeinstallprompt' event was fired.`);
    });

    function showInstallPromotion() {
      var btn = document.querySelector(".card.install");
      btn.style.opacity = "";
      // btn.style.cursor = "pointer";
      btn.classList.add("pointer");
      btn.addEventListener("click", startInstall);
    }

    function hideInstallPromotion() {
      var btn = document.querySelector(".card.install");
      btn.style.opacity = "0.3";
      // btn.style.cursor = "auto";
      btn.classList.remove("pointer");
      btn.removeEventListener("click", startInstall);
    }

    async function startInstall() {
      // Hide the app provided install promotion
      hideInstallPromotion();
      // Show the install prompt
      deferredPrompt.prompt();
      // Wait for the user to respond to the prompt
      const { outcome } = await deferredPrompt.userChoice;
      // Optionally, send analytics event with outcome of user choice
      // console.log(`User response to the install prompt: ${outcome}`);
      // We've used the prompt and can't use it again, throw it away
      deferredPrompt = null;
    }

    window.addEventListener('appinstalled', () => {
      // Hide the app-provided install promotion
      hideInstallPromotion();
      // Clear the deferredPrompt so it can be garbage collected
      deferredPrompt = null;
      // Optionally, send analytics event to indicate successful install
      // console.log('PWA was installed');

      closeWrap(null, 'settings');
    });

    function getPWADisplayMode() {
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
      if (document.referrer.startsWith('android-app://')) {
        return 'twa';
      } else if (navigator.standalone || isStandalone) {
        return 'standalone';
      }
      return 'browser';
    }

    window.matchMedia('(display-mode: standalone)').addEventListener('change', (evt) => {
      let displayMode = 'browser';
      if (evt.matches) {
        displayMode = 'standalone';
        hideInstallPromotion();
      }
      // Log display mode change to analytics
      // console.log('DISPLAY_MODE_CHANGED', displayMode);
    });
  </script>
  <script>
    
    function checkInitParam() {
      let params = new URLSearchParams(document.location.search);
      const init = params.get("init"); 

      if (init === "file") {
        /*
        setTimeout(function() {
          document.getElementById('fileSelector').click();
        }, 100);*/

      } else if (init === "url") {

        openWrap('webupload');

        /*
        setTimeout(function() {
          var wrapURL = document.querySelector("#urlBar");
          setTimeout(function() {
            wrapURL.focus();
          }, 100);
        }, 100);*/

      }
      
    }

    checkInitParam();

  </script>
</html>
