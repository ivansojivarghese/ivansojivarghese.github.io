<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Media Player</title>
    
    <meta name="theme-color" content="#A10000">

    <meta charset="utf-8" />
    <meta name="viewport" content="viewport-fit=cover, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, shrink-to-fit=no, interactive-widget=overlays-content" >
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src *; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'; img-src * data: 'unsafe-inline'; connect-src * 'unsafe-inline'; frame-src *;"> -->
    
    <!-- OpenGraph/Social sharing -->
    <meta
      name="description"
      content="An installable media player app."
    />
    <meta
      name="og:description"
      content="An installable media player app."
    />
    <meta
      property="og:image"
      content="https://cdn.glitch.global/4604ff4b-6eb8-48c8-899f-321d23359af1/Media%20Player%20OG%20Image.png?v=1721623654736"
    />
    <meta property="og:title" content="Media Player" />
    <meta name="twitter:card" content="summary" />
    <!-- 
    <link
      rel="icon"
      href="https://cdn.glitch.global/4604ff4b-6eb8-48c8-899f-321d23359af1/play.svg?v=1720968680771"
    /> -->
    <link
      rel="icon"
      href="https://ivansojivarghese.github.io/media-player/play.png"
    />
    
    <link rel="stylesheet" type="text/css" href="https://ivansojivarghese.github.io/media-player/main.css" />
    <link rel="stylesheet" type="text/css" href="https://ivansojivarghese.github.io/media-player/new.css" />
    <link rel="stylesheet" type="text/css" href="https://ivansojivarghese.github.io/media-player/res_m.css" />
    
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
    </style>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Raleway&display=swap');
    </style>
    
    <!-- <script src="https://cdn.jsdelivr.net/npm/@thelevicole/youtube-to-html5-loader@5/dist/YouTubeToHtml5.js"></script> -->
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- PWA setup - update public/sw.js if you add your own assets like a new .css file -->
    <link rel="manifest" href="https://ivansojivarghese.github.io/media-player/manifest.json" />
    
    <script src="https://ivansojivarghese.github.io/media-player/index.js" async defer></script>
    
  </head>
  <body>
    <main>
      <div class="content">
        <!-- <h1 style="display: none;">Media Player <span>for YouTube</span></h1> -->

        <div id="videoContainer" class="trs">
          <video></video> 
          <div id="videoControls" class="trs">
              <div id="playPauseButton">
                <div class="img"></div>
              </div>
              <div id="fullscreenButton">
                <div class="img controlButton"></div>
              </div>
              <div id="pipButton">
                <div class="img controlButton"></div>
              </div>

              <div id="videoCurrentTime"></div>
              <div id="videoDuration"></div>
              <div id="videoProgressBar"></div>
          </div>
        </div>

        <div class="card trs settings" onclick="openWrap('settings')">
          <div class="img"></div>
        </div>
        <!-- 
        <div class="card upload" onclick="document.getElementById('fileSelector').click()">
              <input class="card upload" id="fileSelector" type="file" style="display: none;" multiple accept=".mp4, .webm, .ogg"/>
            <input class="card img upload" type="button">
            </div> -->
      </div>
      <div id="settingsOptions" class="wrap" onclick="closeWrap(event, 'settings')">
        <div class="container">
            <!-- 
            <div class="card fullscreen" onclick="toggleFulls()">
              <div class="img"></div>
            </div>
            <div class="card play" onclick="play()">
              <div class="img"></div>
            </div>
            <div class="card pause" onclick="pause()">
              <div class="img"></div>
            </div> -->
            <div class="card load" onclick="load()">
              <div class="img"></div>
            </div>
            <div class="card install" onclick="" style="opacity: 0.3;">
              <div class="img"></div>
            </div>
            
            <div class="card upload" onclick="document.getElementById('fileSelector').click()">
              <input class="card upload" id="fileSelector" type="file" style="display: none;" multiple accept=".mp4, .webm, .ogg"/>
            <input class="card img upload" type="button">
            </div> 
          
            <div class="card web_upload" onclick="openWrap('webupload')">
              <div class="img"></div>
            </div>
          <!-- 
            <div class="card pip" onclick="togglePiP()" style="display: none;">
              <div class="img"></div>
            </div> -->
          <!-- 
            <div class="card pip">
              <div class="img"></div>
            </div>
            <div class="card pip">
              <div class="img"></div>
            </div>
            <div class="card pip">
              <div class="img"></div>
            </div>
            <div class="card pip">
              <div class="img"></div>
            </div> -->
          </div>
        </div>
      <div id="urlInput" class="wrap" onclick="closeWrap(event, 'webupload')">
        <div class="container block">
            <h3>URL Entry</h3>
            <p>for YouTube</p>
            <input class="noExit" type="url" id="urlBar" placeholder="YouTube video URL" name="">
            <input id="urlSubmit" class="" type="submit" onclick="getURL()">
        </div>
      </div>
    </main>
  </body>
  <script src="https://ivansojivarghese.github.io/media-player/dev.js"></script>
  <script>
    
    // REFERENCED FROM: https://github.com/googlesamples/web-fundamentals/blob/gh-pages/fundamentals/media/mobile-web-video-playback.js

    // https://googlesamples.github.io/web-fundamentals/fundamentals/media/mobile-web-video-playback.html 

    const video = document.querySelector('video');
    const videoContainer = document.querySelector("#videoContainer");
    const videoDuration = document.querySelector('#videoDuration');

    const videoCurrentTime = document.querySelector('#videoCurrentTime');
    const videoProgressBar = document.querySelector('#videoProgressBar');

    const playPauseButton = document.querySelector('#playPauseButton');
    const fullscreenButton = document.querySelector('#fullscreenButton');
    const pipButton = document.querySelector('#pipButton');

    var controlsHideInt = null;

    playPauseButton.addEventListener('click', function (event) {
      event.stopPropagation();
      clearTimeout(controlsHideInt);
      controlsHideInt = null;
      if (videoControls.classList.contains('visible')) {
        if (video.paused && video.src !== "") {
          video.play();
        } else {
          video.pause();
        }
      }
    });

    fullscreenButton.addEventListener('click', function(event) {
      event.stopPropagation();
      if (videoControls.classList.contains('visible')) {
        if (document.fullscreenElement) {
          document.exitFullscreen();
          fullscreenButton.children[0].classList.remove("exit");
        } else {
          requestFullscreenVideo();
          lockScreenInLandscape();
          fullscreenButton.children[0].classList.add("exit");
        }
      }
    });

    function requestFullscreenVideo() {
      if (videoContainer.requestFullscreen) {
        videoContainer.requestFullscreen();
      } else {
        video.webkitEnterFullscreen();
      }
    }

    function lockScreenInLandscape() {
      if (!('orientation' in screen)) {
        return;
      }

      // Let's force landscape mode only if device is in portrait mode and can be held in one hand.
      if (matchMedia('(orientation: portrait) and (max-device-width: 768px)').matches) {
        screen.orientation.lock('landscape').then(function() {
          // When screen is locked in landscape while user holds device in
          // portrait, let's use the Device Orientation API to unlock screen only
          // when it is appropriate to create a perfect and seamless experience.
          listenToDeviceOrientationChanges();
        });
      }
    }

    function listenToDeviceOrientationChanges() {
      if (!('DeviceOrientationEvent' in window)) {
        return;
      }

      var previousDeviceOrientation, currentDeviceOrientation;
      window.addEventListener('deviceorientation', function onDeviceOrientationChange(event) {
        // event.beta represents a front to back motion of the device and
        // event.gamma a left to right motion.
        if (Math.abs(event.gamma) > 10 || Math.abs(event.beta) < 10) {
          previousDeviceOrientation = currentDeviceOrientation;
          currentDeviceOrientation = 'landscape';
          return;
        }
        if (Math.abs(event.gamma) < 10 || Math.abs(event.beta) > 10) {
          previousDeviceOrientation = currentDeviceOrientation;
          // When device is rotated back to portrait, let's unlock screen orientation.
          if (previousDeviceOrientation == 'landscape') {
            screen.orientation.unlock();
            window.removeEventListener('deviceorientation', onDeviceOrientationChange);
          }
        }
      });
    }

    pipButton.addEventListener('click', function (event) {
      event.stopPropagation();
      if (videoControls.classList.contains('visible')) {
        if (video.requestPictureInPicture) {
          if (document.pictureInPictureElement) {
            document.exitPictureInPicture();
            pipButton.children[0].classList.remove("exit");
          } else if (document.pictureInPictureEnabled) {
            video.requestPictureInPicture();
            pipButton.children[0].classList.add("exit");
          }
        }
      }
    });

    video.addEventListener('play', function () {
      playPauseButton.classList.add('playing');
      if (controlsHideInt === null) {
        controlsHideInt = setTimeout(hideVideoControls, 3000); // hide controls after 3 sec. if no activity
      }
    });

    video.addEventListener('pause', function () {
      playPauseButton.classList.remove('playing');
    });

    function showVideoControls() {
      videoControls.classList.add('visible');
      // videoCurrentTime.textContent = secondsToTimeCode(video.currentTime);
      // videoProgressBar.style.transform = `scaleX(${video.currentTime / video.duration})`;
    }

    function hideVideoControls() {
      videoControls.classList.remove('visible');
    }

    videoControls.addEventListener('click', function(event) {
      clearTimeout(controlsHideInt);
      controlsHideInt = null;
      if (videoControls.classList.contains('visible')) {
        hideVideoControls();
      } else {
        showVideoControls();
        if (controlsHideInt === null) {
          controlsHideInt = setTimeout(hideVideoControls, 3000); // hide controls after 3 sec. if no activity
        }
      }
    });

    document.addEventListener('DOMContentLoaded', function() {
      showVideoControls();
      if (!video.requestPictureInPicture) {
        pipButton.style.display = "none";
      }
    });

    function secondsToTimeCode(seconds) {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = Math.floor(seconds % 60);
      return [
        h,
        m > 9 ? m : '0' + m,
        s > 9 ? s : '0' + s,
      ].filter(Boolean).join(':');
    }


    /*
    video.addEventListener('loadedmetadata', function () {
    videoDuration.textContent = secondsToTimeCode(video.duration);
    videoCurrentTime.textContent = secondsToTimeCode(video.currentTime);
    videoProgressBar.style.transform = `scaleX(${
      video.currentTime / video.duration
    })`;
  });*/
  </script>
  <script>
    
    var wrap = document.querySelector("#settingsOptions");
        if (window.FileList && window.File) {
          document.getElementById('fileSelector').addEventListener('change', event => {
              // console.log(event.target.files[0]);
              
              const file = event.target.files[0];
              
              var fileURL = URL.createObjectURL(file)
              video.src = fileURL;
            
              video.play();
            
              // video.classList.remove("error");
            
              // video.style.border = "0.15rem solid #A10000";
            
              wrap.style.display = "";
          });
        }
    
    document.onvisibilitychange = function() {
      if (document.visibilityState === 'hidden') {
        if (!video.paused) {
            video.requestPictureInPicture();
        }
      } else {
        if (!video.paused) {
            document.exitPictureInPicture();
        }
      }
    };
    
    if (PictureInPictureWindow) {
        var cardPip = document.querySelector(".card.pip");
        cardPip.style.display = "block";
    }
  </script>
  <script>
    function isDarkMode() { // dark mode detection
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    }
    
    if (isDarkMode()) {
      document.body.style.color = "#FFF";
      document.body.style.backgroundColor = "#171717";
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change',({ matches }) => { // detect color theme (live) change
      if (matches) { // change to dark mode
        document.body.style.color = "#FFF";
        document.body.style.backgroundColor = "#171717";
      } else {
        document.body.style.color = "";
        document.body.style.backgroundColor = "";
      }
    });
  </script>
  <script>
    var wrap = document.querySelector("#settingsOptions");
    function togglePiP() {
      const video = document.querySelector('video');
       if (document.pictureInPictureElement) {
          document.exitPictureInPicture();
        } else if (document.pictureInPictureEnabled) {
          video.requestPictureInPicture();
        }
      wrap.style.display = "";
    }
    function toggleFulls() {
      const video = document.querySelector('video');
      video.requestFullscreen();
      wrap.style.display = "";
    }
    function play() {
      const video = document.querySelector('video');
      video.play();
      wrap.style.display = "";
    }
    function pause() {
      const video = document.querySelector('video');
      video.pause();
      wrap.style.display = "";
    }
    function load() {
      const video = document.querySelector('video');
      video.load();
      // wrap.style.display = "";
    }
    function mute() {
      const video = document.querySelector('video');
      if (!video.muted) {
        video.muted = true;
      } else {
        video.muted = false;
      }
      wrap.style.display = "";
    }
  </script>
  <script>
    
    var videoDetails;
    var videoSubmit;
    
    async function getParams(id) {
      let params = new URLSearchParams(document.location.search);
      const link = params.get("description"); 
    
      if (link !== null) {
        
        // NO ACCESS TO SHORTS, LIVE, ATTRIBUTED OR EMBEDDED VIDEOS
        if (!link.includes("embed") && !link.includes("attribution_link") && !link.includes("shorts") && !link.includes("live")) {
        
        if (link.includes("youtube.com") && !link.includes("m.youtube.com")) {
          
          // video.classList.remove("error");
          // video.style.border = "0.15rem solid #A10000";
        
          var sIndex = link.indexOf("v=");
          var eIndex = link.indexOf("&");
          var sTrue;
          
          if (sIndex !== -1) {
            sTrue = true;
            if (eIndex === -1 && eIndex > sIndex) {
              var eIndex = link.indexOf("#");
              if (eIndex === -1) {
                eIndex = link.length;
              }
            } else if (eIndex < sIndex) {
              eIndex = link.length;
            }
          } else {
            sTrue = false;
            sIndex = link.lastIndexOf("/");
            eIndex = link.indexOf("?");
            if (eIndex === -1) {
              eIndex = link.length;
            }
          }
          
          var id = link.substring(sIndex, eIndex);
          if (sTrue) {
            var videoID = id.substring(2, id.length);
          } else {
            var videoID = id.substring(1, id.length);
          }

          // let params = new URLSearchParams(link);
          
        } else if (link.includes("m.youtube.com")) {
          
          // video.classList.remove("error");
          // video.style.border = "0.15rem solid #A10000";
          
          var sIndex = link.indexOf("v=");
          var eIndex = link.indexOf("&");
          var sTrue;
          
          if (sIndex !== -1) {
            sTrue = true;
            if (eIndex === -1 && eIndex > sIndex) {
              var eIndex = link.indexOf("#");
              if (eIndex === -1) {
                eIndex = link.length;
              }
            } else if (eIndex < sIndex) {
              eIndex = link.length;
            }
          } else {
            sTrue = false;
            sIndex = link.lastIndexOf("/");
            eIndex = link.indexOf("?");
            if (eIndex === -1) {
              eIndex = link.length;
            }
          }
          
          var id = link.substring(sIndex, eIndex);
          if (sTrue) {
            var videoID = id.substring(2, id.length);
          } else {
            var videoID = id.substring(1, id.length);
          }
            
        } else if (link.includes("youtu.be")) {
          
          // video.classList.remove("error");
          // video.style.border = "0.15rem solid #A10000";
          
          var sIndex = link.indexOf("e/");
           var eIndex = link.indexOf("?");
          var sTrue;
          
          if (sIndex === -1) {
            sTrue = false;
            sIndex = link.lastIndexOf("/");
            eIndex = link.indexOf("?");
            if (eIndex === -1) {
              eIndex = link.indexOf("&");
              if (eIndex === -1) {
                eIndex = link.length;
              }
            }
          } else {
            sTrue = true;
            if (eIndex === -1) {
              eIndex = link.indexOf("&");
              if (eIndex === -1) {
                eIndex = link.length;
              }
            }
          }
          
          var id = link.substring(sIndex, eIndex);
          if (sTrue) {
            var videoID = id.substring(2, id.length);
          } else {
            var videoID = id.substring(1, id.length);
          }
        } else {
          
          //video.classList.add("error");
        }
        } else {
          
          //video.classList.add("error");
        }
        
        console.log("Video ID: " + videoID);
        
      } else if (id) {
        
        var videoID = id;
        
      } 
      
      if (link !== null || videoSubmit) {
      
      // REFERENCE: https://rapidapi.com/ytjar/api/ytstream-download-youtube-videos
      
      const url = 'https://ytstream-download-youtube-videos.p.rapidapi.com/dl?id=' + videoID;
      const options = {
        method: 'GET',
        headers: {
          'x-rapidapi-key': '89ce58ef37msh8e59da617907bbcp1455bajsn66709ef67e50',
          'x-rapidapi-host': 'ytstream-download-youtube-videos.p.rapidapi.com'
        }
      };

      try {
        const response = await fetch(url, options);
        videoDetails = await response.json();
        console.log(videoDetails);
        
        video.src = videoDetails.formats["0"].url;
        
        video.play();
        
      } catch (error) {
        console.error(error);
        
        // video.classList.add("error");
      }
        
      }
    }
    
    
    getParams(null);
    
  </script>
  <script>
      function openWrap(mod) {
        if (mod === 'settings') {
          var wrap = document.querySelector("#settingsOptions");
        } else {
          var wrap = document.querySelector("#urlInput");
          var wrapURL = document.querySelector("#urlBar");
          setTimeout(function() {
            wrapURL.focus();
          }, 100);
        }
        wrap.style.display = "block";
      }

      function closeWrap(e, mod) {
        if (mod === 'settings') {
          var wrap = document.querySelector("#settingsOptions");
          if (e !== null) {
            if (!e.target.classList.contains("card") && !e.target.classList.contains("img")) {
              wrap.style.display = "";
            }
          } else {
            wrap.style.display = "";
          }
        } else {
          var wrap = document.querySelector("#urlInput");
          var urlBar = document.querySelector("#urlBar");
          if (!e.target.classList.contains("noExit")) {
            wrap.style.display = "";
            urlBar.value = "";
          }
        }
        
      }
  </script>
  <script>
    var settingsBtn = document.querySelector(".card.settings");
    var videoPlaying = false;

    video.onplay = (event) => {
      videoPlaying = true;
      // video.style.border = "0.15rem solid #007000";
    };
    
    document.onclick = function() {
      if (!video.classList.contains("error") && video.src && videoPlaying) {
        // video.style.border = "0.15rem solid #007000";
      }
    };
    
    document.addEventListener("visibilitychange", function() {
      if (document.visibilityState === 'hidden') {
         if (!video.classList.contains("error") && video.src) {
            // video.style.border = "0.15rem solid #A10000";
          }
      }
    });
  </script>
  <script>

    // REFERENCE: https://web.dev/articles/customize-install

    // Initialize deferredPrompt for use later to show browser install prompt.
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Stash the event so it can be triggered later.
      deferredPrompt = e;
      // Update UI notify the user they can install the PWA
      showInstallPromotion();
      // Optionally, send analytics event that PWA install promo was shown.
      // console.log(`'beforeinstallprompt' event was fired.`);
    });

    function showInstallPromotion() {
      var btn = document.querySelector(".card.install");
      btn.style.opacity = "";
      // btn.style.cursor = "pointer";
      btn.classList.add("pointer");
      btn.addEventListener("click", startInstall);
    }

    function hideInstallPromotion() {
      var btn = document.querySelector(".card.install");
      btn.style.opacity = "0.3";
      // btn.style.cursor = "auto";
      btn.classList.remove("pointer");
      btn.removeEventListener("click", startInstall);
    }

    async function startInstall() {
      // Hide the app provided install promotion
      hideInstallPromotion();
      // Show the install prompt
      deferredPrompt.prompt();
      // Wait for the user to respond to the prompt
      const { outcome } = await deferredPrompt.userChoice;
      // Optionally, send analytics event with outcome of user choice
      // console.log(`User response to the install prompt: ${outcome}`);
      // We've used the prompt and can't use it again, throw it away
      deferredPrompt = null;
    }

    window.addEventListener('appinstalled', () => {
      // Hide the app-provided install promotion
      hideInstallPromotion();
      // Clear the deferredPrompt so it can be garbage collected
      deferredPrompt = null;
      // Optionally, send analytics event to indicate successful install
      // console.log('PWA was installed');

      closeWrap(null, 'settings');
    });

    function getPWADisplayMode() {
      const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
      if (document.referrer.startsWith('android-app://')) {
        return 'twa';
      } else if (navigator.standalone || isStandalone) {
        return 'standalone';
      }
      return 'browser';
    }

    window.matchMedia('(display-mode: standalone)').addEventListener('change', (evt) => {
      let displayMode = 'browser';
      if (evt.matches) {
        displayMode = 'standalone';
        hideInstallPromotion();
      }
      // Log display mode change to analytics
      // console.log('DISPLAY_MODE_CHANGED', displayMode);
    });
  </script>
  <script>
      // REFERENCED FROM MEDIUM: https://medium.com/js-bytes/how-to-keep-your-screen-awake-using-javascript-aa15775d9bff

      // let screenLock;

      function isScreenLockSupported() {
          return ('wakeLock' in navigator);
      }

      async function getScreenLock() {
          if (isScreenLockSupported()){
              // let screenLock;
              try {
                  screenLock = await navigator.wakeLock.request('screen');
              } catch(err) {
                  console.log(err.name, err.message);
              }
              // return screenLock;
          }
      }

      async function releaseScreenLock(screenLock) {
          await screenLock.release().then(() => {
              screenLock = null;
          });
      }

      getScreenLock();
  </script>
  <script>
    var inp = document.getElementById('urlBar');

    inp.addEventListener('select', function() {
      this.selectionStart = this.selectionEnd;
    }, false);
    
    function getURL() {
      var wrapURL = document.querySelector("#urlInput");
      var wrap = document.querySelector("#settingsOptions");
      var contents = inp.value;
      
      // NO ACCESS TO SHORTS, LIVE, ATTRIBUTED OR EMBEDDED VIDEOS
      if (!contents.includes("embed") && !contents.includes("attribution_link") && !contents.includes("shorts") && !contents.includes("live")) {
        
      if (contents.includes("youtube.com") && !contents.includes("m.youtube.com")) {
        
        //video.classList.remove("error");
        // video.style.border = "0.15rem solid #A10000";
        
        var sIndex = contents.indexOf("v=");
        var eIndex = contents.indexOf("&");
        var sTrue;
        
        if (sIndex !== -1) {
          sTrue = true;
          if (eIndex === -1 && eIndex > sIndex) {
            var eIndex = contents.indexOf("#");
              if (eIndex === -1) {
                eIndex = contents.length;
              }
          } else if (eIndex < sIndex) {
            eIndex = contents.length;
          }
        } else {
          sTrue = false;
          sIndex = contents.lastIndexOf("/");
          eIndex = contents.indexOf("?");
          if (eIndex === -1) {
            eIndex = contents.length;
          }
        }
        
        var id = contents.substring(sIndex, eIndex);
        if (sTrue) {
          var videoID = id.substring(2, id.length);
        } else {
          var videoID = id.substring(1, id.length);
        }
        
      } else if (contents.includes("m.youtube.com")) {
        
          // video.classList.remove("error");
        // video.style.border = "0.15rem solid #A10000";
          
          var sIndex = contents.indexOf("v=");
          var eIndex = contents.indexOf("&");
          var sTrue;
        
          if (sIndex !== -1) {
            sTrue = true;
            if (eIndex === -1 && eIndex > sIndex) {
              var eIndex = contents.indexOf("#");
              if (eIndex === -1) {
                eIndex = contents.length;
              }
            } else if (eIndex < sIndex) {
              eIndex = contents.length;
            }
          } else {
            sTrue = false;
            sIndex = contents.lastIndexOf("/");
            eIndex = contents.indexOf("?");
            if (eIndex === -1) {
              eIndex = contents.length;
            }
          }
        
          var id = contents.substring(sIndex, eIndex);
          if (sTrue) {
            var videoID = id.substring(2, id.length);
          } else {
            var videoID = id.substring(1, id.length);
          }
            
        } else if (contents.includes("youtu.be")) {
          
          // video.classList.remove("error");
          // video.style.border = "0.15rem solid #A10000";
          
          var sIndex = contents.indexOf("e/");
           var eIndex = contents.indexOf("?");
          var sTrue;
          
          if (sIndex === -1) {
            sTrue = false;
            sIndex = contents.lastIndexOf("/");
            eIndex = contents.indexOf("?");
            if (eIndex === -1) {
              eIndex = contents.indexOf("&");
              if (eIndex === -1) {
                eIndex = contents.length;
              }
            }
          } else {
            sTrue = true;
            if (eIndex === -1) {
              eIndex = contents.indexOf("&");
              if (eIndex === -1) {
                eIndex = contents.length;
              }
            }
          }
          
          var id = contents.substring(sIndex, eIndex);
          if (sTrue) {
            var videoID = id.substring(2, id.length);
          } else {
            var videoID = id.substring(1, id.length);
          }
        } else {
          
          //video.classList.add("error");
        }
      /*
      let VID_REGEX =
      /(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
      videoID = contents.match(VID_REGEX)[1];*/
      
      console.log("Video ID: " + videoID);
        
      videoSubmit = true;
      
      // if (videoID) {
      getParams(videoID);
      // }
      
      wrapURL.style.display = "";
      wrap.style.display = "";
      inp.value = "";
        
    } else {
      
      //video.classList.add("error");
    }
      
      // document.getElementById("urlSubmit").click();
    }
    
    document.addEventListener("keypress", function(event) {
      if (event.key === "Enter" && inp.value) {
        document.getElementById("urlSubmit").click();
        closeWrap(event, 'webupload');
        closeWrap(event, 'settings');
        event.preventDefault();
      }
    });
    
    /*
    inp.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        document.getElementById("urlSubmit").click();
        // closeWrap(event, 'webupload');
        event.preventDefault();
      }
    });*/
  </script>
  <script>
    
    function checkInitParam() {
      let params = new URLSearchParams(document.location.search);
      const init = params.get("init"); 

      if (init === "file") {
        /*
        setTimeout(function() {
          document.getElementById('fileSelector').click();
        }, 100);*/

      } else if (init === "url") {

        openWrap('webupload');

        /*
        setTimeout(function() {
          var wrapURL = document.querySelector("#urlBar");
          setTimeout(function() {
            wrapURL.focus();
          }, 100);
        }, 100);*/

      }
      
    }

    checkInitParam();

  </script>
</html>
